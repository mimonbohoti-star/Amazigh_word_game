<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>âµ£ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
#menu{
 background:linear-gradient(135deg,#1d4ed8,#16a34a,#facc15,#dc2626);
 border-radius:22px;
 padding:18px;
}
:root{--accent:#facc15}
*{box-sizing:border-box}
body{
 margin:0;font-family:sans-serif;
 background:radial-gradient(circle at top,#1e293b,#020617);
 color:#fff;display:flex;justify-content:center;align-items:center;
 min-height:100vh;overflow:hidden;
}
.card{
 width:95%;max-width:420px;background:#020617;border-radius:26px;
 padding:20px;
 box-shadow:0 0 0 2px var(--accent),0 30px 60px rgba(0,0,0,.7);
 position:relative;z-index:2;
}
h1{text-align:center;color:var(--accent);margin:6px 0}
img{width:100%;border-radius:16px;margin:10px 0}

.section{display:none}
.section.active{display:block}

.btn{
 width:100%;min-height:52px;margin:8px 0;border:none;border-radius:16px;
 font-size:18px;font-weight:700;cursor:pointer
}
.btn-main{background:var(--accent);color:#000}
.btn-back{background:#0f172a;color:#fff;border:1px solid #334155}

.setting-item{
 display:flex;justify-content:space-between;align-items:center;
 background:#0f172a;border:1px solid #334155;
 border-radius:14px;padding:14px;margin:10px 0;
 font-size:18px;
}

.toggle{
 width:52px;height:28px;border-radius:20px;
 background:#334155;position:relative;cursor:pointer;
}
.toggle::after{
 content:"";position:absolute;top:4px;right:4px;
 width:20px;height:20px;border-radius:50%;
 background:#fff;transition:.3s;
}
.toggle.on{background:var(--accent)}
.toggle.on::after{right:28px}

.answer-boxes{
 display:flex;justify-content:center;gap:8px;margin:12px 0;direction:ltr;
}
.answer-box{
 width:44px;height:44px;border-radius:10px;background:#fff;color:#000;
 display:flex;align-items:center;justify-content:center;font-size:22px
}
.answer-box.ok{background:#22c55e}
.answer-box.bad{background:#ef4444;color:#fff}

.keyboard{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.triangle{grid-template-columns:repeat(3,1fr)}
.key{
 background:#1e293b;
 padding:14px;
 border-radius:14px;
 text-align:center;
 font-size:22px;
 font-weight:bold;
 cursor:pointer;
}

.key.locked{
 position:relative;
 opacity:.35;
 pointer-events:none;
}

.key.locked::after{
 content:"ğŸ”’";
 position:absolute;
 inset:0;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:26px;
}
 background:#1e293b;padding:14px;border-radius:14px;
 text-align:center;font-size:22px;font-weight:bold;cursor:pointer;
}
.key.used{opacity:.25;pointer-events:none}

.wheel{
 width:260px;height:260px;margin:16px auto;
 border-radius:50%;border:3px solid var(--accent);
 position:relative;
}
.wheel .key{
 width:52px;height:52px;border-radius:50%;
 background:var(--accent);color:#000;
 position:absolute;display:flex;align-items:center;justify-content:center;
}

.delete{
 background:#0f172a;border:1px solid #334155;
 border-radius:14px;padding:14px;font-size:20px;font-weight:bold;cursor:pointer;
}

.overlay{
 position:fixed;inset:0;background:rgba(0,0,0,.8);
 display:none;justify-content:center;align-items:center;z-index:5;
}
.overlay.active{display:flex}
.win{
 background:#020617;padding:26px;border-radius:22px;
 box-shadow:0 0 60px var(--accent);text-align:center;
}

.confetti{
 position:fixed;top:-20px;font-size:26px;
 animation:fall linear forwards;pointer-events:none;z-index:10;
}

@keyframes shake{
 0%{transform:translateX(0)}
 25%{transform:translateX(-4px)}
 50%{transform:translateX(4px)}
 75%{transform:translateX(-4px)}
 100%{transform:translateX(0)}
}

.key.shake{
 animation:shake .3s;
}
@keyframes fall{to{transform:translateY(120vh) rotate(360deg);opacity:0}}
</style>
</head>

<body>

<div class="card">

<div id="menu" class="section active">
 <h1>âµ£ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©</h1>
 <button class="btn btn-main" onclick="openMap()">â–¶ï¸ Ø¨Ø¯Ø¡</button>
 <button class="btn btn-back" onclick="show('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<div id="settings" class="section">
 <h1>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>

 <div class="setting-item">
  <span>ğŸ”Š Ø§Ù„ØµÙˆØª</span>
  <div id="soundToggle" class="toggle"></div>
 </div>

 <div class="setting-item">
  <span>ğŸ“³ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²</span>
  <div id="vibeToggle" class="toggle"></div>
 </div>

 <button class="btn btn-back" onclick="show('menu')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<div id="map" class="section">
 <h1>â­ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</h1>
 <div id="mapGrid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px"></div>
 <button class="btn btn-back" onclick="show('menu')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<div id="game" class="section">
 <h1 id="levelTitle"></h1>
 <img id="questionImg">
 <div class="answer-boxes" id="boxes"></div>
<!-- START HINT BUTTON -->
<button class="btn btn-back" id="hintBtn">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
<div id="hintCount">3</div>
<!-- END HINT BUTTON -->
 <div id="wheel" class="wheel"></div>
 <div id="keyboard" class="keyboard"></div>
 <button class="btn btn-back" onclick="show('map')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

</div>

<div id="overlay" class="overlay">
 <div class="win"><h2>ğŸ”¥ Ø£Ø­Ø³Ù†Øª ğŸ”¥</h2></div>
</div>
<div id="finalOverlay" class="overlay">
 <div class="win">
  <h2>ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! ğŸ†</h2>
  <p>Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¨Ù†Ø¬Ø§Ø­</p>
  <button class="btn btn-main" onclick="finalOverlay.classList.remove('active'); show('menu');">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
 </div>
</div>

<script>
/* ===== SETTINGS ===== */
let soundOn = localStorage.getItem("soundOn") !== "0";
let vibeOn  = localStorage.getItem("vibeOn")  !== "0";

/* ğŸ”Š ØµÙˆØª Ø§Ù„ØªØµÙÙŠÙ‚ */
const applauseSound = new Audio("applause.mp3");

const soundToggle = document.getElementById("soundToggle");
const vibeToggle  = document.getElementById("vibeToggle");

function syncToggles(){
 soundToggle.classList.toggle("on",soundOn);
 vibeToggle.classList.toggle("on",vibeOn);
}
soundToggle.onclick=()=>{
 soundOn=!soundOn;
 localStorage.setItem("soundOn",soundOn?1:0);
 syncToggles();
};
vibeToggle.onclick=()=>{
 vibeOn=!vibeOn;
 localStorage.setItem("vibeOn",vibeOn?1:0);
 syncToggles();
};
syncToggles();

/* ===== SOUND (synthetic clap) ===== */
let ctx;
function clap(){
 if(!soundOn) return;
 if(!ctx) ctx=new (window.AudioContext||window.webkitAudioContext)();
 for(let i=0;i<6;i++){
  const o=ctx.createOscillator(),g=ctx.createGain();
  o.type="square"; o.frequency.value=200+Math.random()*400;
  g.gain.setValueAtTime(.5,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.15);
  o.connect(g).connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+.15);
 }
 if(vibeOn && navigator.vibrate) navigator.vibrate([80,40,80]);
}

/* ===== DATA (5 Ù…Ø±Ø§Ø­Ù„ Ã— 3 Ø£Ø³Ø¦Ù„Ø©) ===== */
const stages=[/* Ù†ÙØ³ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù„Ø§ Ø£ÙŠ Ø­Ø°Ù */ 
 {qs:[
  {a:"âµœâ´°â´¼âµ“âµ¢âµœ",shape:"circle",img:"sun.jpg"},
  {a:"â´°âµ¢âµ“âµ”",shape:"triangle",img:"moon.jpg"},
  {a:"âµ‰âµœâµ”â´°âµ",shape:"grid",img:"stars.jpg"}
 ]},
 {qs:[
  {a:"â´°â´·âµ”â´°âµ”",shape:"circle",img:"mountain.jpg"},
  {a:"â´°âµ™âµ‰â´¼",shape:"triangle",img:"river.jpg"},
  {a:"âµœâ´°âµâ´°âµ£âµ‰âµ”âµœ",shape:"grid",img:"flower.jpg"}
 ]},
 {qs:[
  {a:"â´°âµ£âµ£âµ“",shape:"circle",img:"flowers.jpg"},
  {a:"â´°âµâ´°âµ",shape:"triangle",img:"river.jpg"},
  {a:"â´°â´¼â´°âµ™",shape:"grid",img:"insect.jpg"}
 ]},
 {qs:[
  {a:"â´°â´½â´°âµ",shape:"circle",img:"sun.jpg"},
  {a:"â´°âµâµ£â´°âµ”",shape:"triangle",img:"moon.jpg"},
  {a:"â´°â´¼âµ“âµ™",shape:"grid",img:"flower.jpg"}
 ]},
 {qs:[
  {a:"â´°âµ£âµ£âµ“",shape:"circle",img:"stars.jpg"},
  {a:"â´°âµâ´°âµ",shape:"triangle",img:"river.jpg"},
  {a:"âµœâ´°â´¼âµ“âµ¢âµœ",shape:"grid",img:"sun.jpg"}
 ]}
];

let unlocked=+localStorage.getItem("amazighUnlocked")||0;
let stage=0,q=0,input=[],drag=false;
const symbols=["ğŸŒ¸","ğŸŒº","ğŸŒ¹","â¤ï¸","ğŸ’–","ğŸ’","âµ£","âµ‰","âµœ","â´°"];

function show(id){
 document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}

function openMap(){
 mapGrid.innerHTML="";
 stages.forEach((_,i)=>{
  const d=document.createElement("div");
  d.className = "key" + (i > unlocked ? " locked" : "");
  d.textContent="Ù…Ø±Ø­Ù„Ø© "+(i+1);
  if(i<=unlocked)d.onclick=()=>startStage(i);
  mapGrid.appendChild(d);
 });
 show("map");
}
function startStage(i){
 stage=i;
 q=0;
 hintsLeft = 3;
 hintsUsed = 0;
 startQuestion();
}
let hintsLeft = 3;
let hintsUsed = 0;
let hints = 3;

function updateHintCount(){
  document.getElementById("hintCount").textContent = hints;
}

updateHintCount();
function startQuestion(){
 input=[];
 hintsLeft = 3; // Ø¥Ø¹Ø§Ø¯Ø© 3 ØªÙ„Ù…ÙŠØ­Ø§Øª Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„
 const L=stages[stage].qs[q];
 levelTitle.textContent=`Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${stage+1} â€” Ø³Ø¤Ø§Ù„ ${q+1}/3`;
 questionImg.src=L.img;
 renderBoxes(L); renderBoard(L); show("game");
}

function renderBoxes(L){
 boxes.innerHTML="";
 for(let i=0;i<L.a.length;i++) boxes.innerHTML+=`<div class="answer-box"></div>`;
}

function renderBoard(L){
 keyboard.innerHTML=""; wheel.innerHTML="";
 keyboard.style.display="none"; wheel.style.display="none";
 const letters=[...L.a].sort(()=>Math.random()-.5);

 if(L.shape==="circle"){
  wheel.style.display="block";
  const r=110,c=130;
  letters.forEach((ch,j)=>{
   const a=2*Math.PI*j/letters.length;
   const k=makeKey(ch);
   k.style.left=c+r*Math.cos(a)-26+"px";
   k.style.top =c+r*Math.sin(a)-26+"px";
   wheel.appendChild(k);
  });
 }else{
  keyboard.style.display="grid";
  if(L.shape==="triangle") keyboard.className="triangle";
  letters.forEach(ch=>{
   const k=makeKey(ch); k.onclick=()=>pick(k,L); keyboard.appendChild(k);
  });
  const del=document.createElement("div");
  del.className="delete"; del.textContent="âŒ«"; del.onclick=removeLast;
  keyboard.appendChild(del);
 }
}

function makeKey(ch){
 const k=document.createElement("div");
 k.className="key"; k.textContent=ch; k.dataset.ch=ch;
 return k;
}

function pick(el,L){
 if(el.classList.contains("used")||input.length>=L.a.length)return;
 el.classList.add("used"); input.push(el); refresh();
 if(input.length===L.a.length && L.shape!=="circle") check(L);
}

function removeLast(){
 if(!input.length)return;
 const last=input.pop(); if(last) last.classList.remove("used"); refresh();
}
document.getElementById("hintBtn").onclick = () => {
 const L = stages[stage].qs[q];

 if (hintsLeft <= 0) return;              // Ù„Ø§ ØªÙ„Ù…ÙŠØ­Ø§Øª
 if (input.length >= L.a.length) return; // Ø§Ù„Ø¬ÙˆØ§Ø¨ Ù…ÙƒØªÙ…Ù„

 const ch = L.a[input.length];
 const keys = document.querySelectorAll(".key");

 for (let k of keys) {
  if (k.dataset.ch === ch && !k.classList.contains("used")) {
   pick(k, L);
   hintsLeft--; // 3 â†’ 2 â†’ 1 â†’ 0
hintsUsed++;
   break;
  }
 }
};

wheel.addEventListener("pointerdown",e=>{
 const L=stages[stage].qs[q];
 if(L.shape!=="circle")return; drag=true; dragPick(e,L);
});
wheel.addEventListener("pointermove",e=>{ if(drag) dragPick(e,stages[stage].qs[q]); });
document.addEventListener("pointerup",()=>{ if(drag){drag=false;
let hintsLeft = 3; // Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ù…ÙŠØ­Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
updateHintCount();
 check(stages[stage].qs[q]);} });

function dragPick(e,L){
 const el=document.elementFromPoint(e.clientX,e.clientY);
 if(el&&el.classList.contains("key")) pick(el,L);
}

function updateHintCount(){
 document.getElementById("hintCount").textContent = hintsLeft;
}

function refresh(){
 document.querySelectorAll(".answer-box").forEach((b,i)=>{
  b.textContent=input[i]?.dataset.ch||""; b.className="answer-box";
 });
}

function celebrate(){
 if(soundOn){
 applauseSound.currentTime = 0;
 applauseSound.play();
}
 for(let i=0;i<40;i++){
  const c=document.createElement("div");
  c.className="confetti";
  c.textContent=symbols[Math.floor(Math.random()*symbols.length)];
  c.style.left=Math.random()*100+"vw";
  c.style.animationDuration=2+Math.random()*2+"s";
  document.body.appendChild(c);
  setTimeout(()=>c.remove(),4000);
 }
}

function check(L){
 if(input.length!==L.a.length)return;
 const ok=input.map(k=>k.dataset.ch).join("")===L.a;
 document.querySelectorAll(".answer-box").forEach(b=>b.classList.add(ok?"ok":"bad"));

 if(ok){
  celebrate(); overlay.classList.add("active");
  setTimeout(()=>{
   overlay.classList.remove("active");
   q++;
   if(q<3) startQuestion();
   else{
 if(stage === stages.length - 1){
  // ğŸ† Ø¢Ø®Ø± Ù…Ø±Ø­Ù„Ø© â†’ Ø´Ø§Ø´Ø© Ø§Ù„ÙÙˆØ² Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
  document.getElementById("finalOverlay").classList.add("active");
 }else{
  if(stage === unlocked){
   unlocked++;
   localStorage.setItem("amazighUnlocked", unlocked);
  }
  show("map");
 }
}
  },1200);
 }else setTimeout(startQuestion,700);
 }
function getStars(){
 if(hintsUsed === 0) return 3;
 if(hintsUsed === 1) return 2;
 return 1;
}
</script>
</body>
</html>
