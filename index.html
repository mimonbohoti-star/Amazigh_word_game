<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>âµ£ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{--accent:#facc15}
*{box-sizing:border-box}
body{
 margin:0;font-family:sans-serif;
 background:radial-gradient(circle at top,#1e293b,#020617);
 color:#fff;display:flex;justify-content:center;align-items:center;
 min-height:100vh;
}
.card{
 width:95%;max-width:420px;background:#020617;border-radius:26px;
 padding:20px;
 box-shadow:0 0 0 2px var(--accent),0 30px 60px rgba(0,0,0,.7);
}
h1{text-align:center;color:var(--accent);margin:6px 0}
img{width:100%;border-radius:16px;margin:10px 0}

.section{display:none}
.section.active{display:block}

.btn{
 width:100%;min-height:52px;margin:8px 0;border:none;border-radius:16px;
 font-size:18px;font-weight:700;cursor:pointer
}
.btn-main{background:var(--accent);color:#000}
.btn-back{background:#0f172a;color:#fff;border:1px solid #334155}

.answer-boxes{
 display:flex;justify-content:center;gap:8px;margin:12px 0;
 direction:ltr;
}
.answer-box{
 width:44px;height:44px;border-radius:10px;background:#fff;color:#000;
 display:flex;align-items:center;justify-content:center;font-size:22px
}
.answer-box.ok{background:#22c55e}
.answer-box.bad{background:#ef4444;color:#fff}

/* BOARDS */
.keyboard{
 display:grid;grid-template-columns:repeat(4,1fr);gap:10px;
 touch-action:none;
}
.triangle{
 display:grid;grid-template-columns:repeat(3,1fr);gap:10px;
 justify-items:center;touch-action:none;
}
.key{
 background:#1e293b;padding:14px;border-radius:14px;
 text-align:center;font-size:22px;font-weight:bold;
 user-select:none;
}
.key.used{opacity:.25}

.wheel{
 width:260px;height:260px;margin:16px auto;
 border-radius:50%;border:3px solid var(--accent);
 position:relative;touch-action:none;
}
.wheel .key{
 width:52px;height:52px;border-radius:50%;
 background:var(--accent);color:#000;
 position:absolute;display:flex;
 align-items:center;justify-content:center;
}

/* CELEBRATION */
.overlay{
 position:fixed;inset:0;background:rgba(0,0,0,.9);
 display:none;justify-content:center;align-items:center;
}
.overlay.active{display:flex}
.win{
 background:#020617;padding:26px;border-radius:22px;
 box-shadow:0 0 60px var(--accent);
 text-align:center;
 animation:pulse .6s infinite alternate;
}
@keyframes pulse{
 from{box-shadow:0 0 20px var(--accent)}
 to{box-shadow:0 0 80px #fff}
}
</style>
</head>

<body>

<div class="card">

<div id="menu" class="section active">
 <h1>âµ£ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©</h1>
 <button class="btn btn-main" onclick="openMap()">â–¶ï¸ Ø¨Ø¯Ø¡</button>
</div>

<div id="map" class="section">
 <h1>â­ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</h1>
 <div id="mapGrid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px"></div>
 <button class="btn btn-back" onclick="show('menu')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<div id="game" class="section">
 <h1 id="levelTitle"></h1>
 <img id="questionImg">
 <div class="answer-boxes" id="boxes"></div>

 <div id="wheel" class="wheel"></div>
 <div id="keyboard" class="keyboard"></div>

 <button class="btn btn-back" onclick="show('map')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

</div>

<div id="overlay" class="overlay">
 <div class="win">
  <h2>ğŸ”¥ Ø£Ø­Ø³Ù†Øª ğŸ”¥</h2>
 </div>
</div>

<script>
/* ========= DATA ========= */
const levels=[
 {a:"âµœâ´°â´¼âµ“âµ¢âµœ",shape:"circle",img:"images/sun.jpg"},
 {a:"â´°âµ¢âµ“âµ”",shape:"triangle",img:"images/moon.jpg"},
 {a:"âµ‰âµœâµ”â´°âµ",shape:"grid",img:"images/stars.jpg"},
 {a:"â´°â´·âµ”â´°âµ”",shape:"circle",img:"images/mountain.jpg"}
];

let unlocked=+localStorage.getItem("amazighUnlocked")||0;
let cur=0,input=[],drag=false;

/* ========= NAV ========= */
function show(id){
 document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}

function openMap(){
 mapGrid.innerHTML="";
 levels.forEach((_,i)=>{
  const d=document.createElement("div");
  d.className="key"+(i>unlocked?" used":"");
  d.textContent="Ù…Ø±Ø­Ù„Ø© "+(i+1);
  if(i<=unlocked)d.onclick=()=>start(i);
  mapGrid.appendChild(d);
 });
 show("map");
}

/* ========= GAME ========= */
function start(i){
 cur=i;resetInput();
 levelTitle.textContent="Ø§Ù„Ù…Ø±Ø­Ù„Ø© "+(i+1);
 questionImg.src=levels[i].img;
 renderBoxes();
 renderBoard();
 show("game");
}

function renderBoxes(){
 boxes.innerHTML="";
 for(let i=0;i<levels[cur].a.length;i++)
  boxes.innerHTML+=`<div class="answer-box"></div>`;
}

function renderBoard(){
 keyboard.innerHTML="";wheel.innerHTML="";
 keyboard.style.display="none";wheel.style.display="none";
 keyboard.className="keyboard";

 const letters=[...levels[cur].a].sort(()=>Math.random()-.5);

 if(levels[cur].shape==="circle"){
  wheel.style.display="block";
  const r=110,c=130;
  letters.forEach((ch,j)=>{
   const a=2*Math.PI*j/letters.length;
   const k=makeKey(ch);
   k.style.left=c+r*Math.cos(a)-26+"px";
   k.style.top =c+r*Math.sin(a)-26+"px";
   wheel.appendChild(k);
  });
 }else{
  keyboard.style.display="grid";
  if(levels[cur].shape==="triangle") keyboard.className="triangle";
  letters.forEach(ch=>keyboard.appendChild(makeKey(ch)));
 }
}

function makeKey(ch){
 const k=document.createElement("div");
 k.className="key";
 k.textContent=ch;
 k.dataset.ch=ch;
 return k;
}

/* ========= DRAG ENGINE ========= */
document.addEventListener("pointerdown",e=>{
 drag=true;
 handlePoint(e);
});
document.addEventListener("pointermove",e=>{
 if(drag) handlePoint(e);
});
document.addEventListener("pointerup",()=>{
 drag=false;
 check();
});

function handlePoint(e){
 const el=document.elementFromPoint(e.clientX,e.clientY);
 if(!el || !el.classList.contains("key")) return;
 if(el.classList.contains("used")) return;
 if(input.length>=levels[cur].a.length) return;

 el.classList.add("used");
 input.push(el);
 refresh();
}

function refresh(){
 document.querySelectorAll(".answer-box").forEach((b,i)=>{
  b.textContent=input[i]?.dataset.ch||"";
  b.className="answer-box";
 });
}

function resetInput(){
 input=[];
}

/* ========= CHECK ========= */
function check(){
 if(input.length!==levels[cur].a.length) return;
 const ok=input.map(k=>k.dataset.ch).join("")===levels[cur].a;
 document.querySelectorAll(".answer-box")
  .forEach(b=>b.classList.add(ok?"ok":"bad"));

 if(ok){
  if(cur===unlocked){
   unlocked++;
   localStorage.setItem("amazighUnlocked",unlocked);
  }
  overlay.classList.add("active");
  setTimeout(()=>{
   overlay.classList.remove("active");
   cur+1<levels.length?start(cur+1):show("menu");
  },800);
 }else{
  setTimeout(()=>{
   renderBoard();
   resetInput();
   renderBoxes();
  },700);
 }
}
</script>

</body>
</html>
