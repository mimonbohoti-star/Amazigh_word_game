<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title> âµ£Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ùˆ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©âµ£</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link
 href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--accent:#facc15}
*{box-sizing:border-box}
/* ===== BODY & BACKGROUND ===== */

body {
  margin: 0;
  font-family: 'Noto Sans Arabic', system-ui, sans-serif;
  color: #ff8c00;

  height: 100vh;           /* Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
  overflow: hidden;        /* Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ */
  
  /* Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø© Ù…ØªØ­Ø±ÙƒØ© */
  background: linear-gradient(180deg, #0055A4 0%, #FFD700 50%, #008A00 100%);
  background-size: 200% 200%;
  animation: bgMove 20s linear infinite, bgColorShift 40s ease-in-out infinite alternate;
}

.question {
  font-size: 16px;
  line-height: 1.7;
  font-weight: 600;
  text-align: center;
}

/* ===== Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© ===== */
@keyframes bgMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes bgColorShift {
  0%   { background: linear-gradient(180deg, #0055A4 0%, #FFD700 50%, #008A00 100%); }
  25%  { background: linear-gradient(180deg, #0060B0 0%, #FFDE00 50%, #009000 100%); }
  50%  { background: linear-gradient(180deg, #004C99 0%, #FFCC00 50%, #007700 100%); }
  75%  { background: linear-gradient(180deg, #0055A4 0%, #FFD700 50%, #008A00 100%); }
  100% { background: linear-gradient(180deg, #0055A4 0%, #FFD700 50%, #008A00 100%); }
}

/* ===== Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© ===== */
.secondary-btn {
  background: transparent;
  border: 2px solid var(--accent);
  color: var(--accent);
  padding: 10px 16px;
  border-radius: 14px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 10px;
}

/* ===== Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Overlay ===== */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.65);
  z-index: 20;
  display: flex;
  align-items: center;
  justify-content: center;
}

.overlay-content {
  background: #000;
  border-radius: 20px;
  padding: 20px;
  width: 90%;
  max-width: 380px;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 0 0 2px var(--accent);
}

.overlay-content h2 {
  text-align: center;
  color: var(--accent);
  margin-bottom: 10px;
}

.overlay-content p,
.overlay-content li {
  font-size: 16px;
  line-height: 1.6;
}

.overlay-content ul {
  padding-inline-start: 18px;
}

.note {
  margin-top: 12px;
  font-size: 14px;
  opacity: .7;
  text-align: center;
}

/* ===== Ø­Ø±ÙˆÙ Ø£Ù…Ø§Ø²ÙŠØºÙŠØ© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© ===== */
body::before {
  content: '';
  position: fixed; /* Ø«Ø§Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© */
  top: 0; left: 0;
  width: 200%; height: 200%;
  background: transparent url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12">\
<text x="0" y="12" font-size="12" fill="white">âµ£â´³â´·â´¹â´»â´¼â´½âµ€âµƒâµ„âµ…âµ‡âµ‰âµŠâµ‹</text>\
</svg>') repeat;
  background-size: 40px 40px;
  animation: lettersMove 60s linear infinite;
  pointer-events: none;
  z-index: 1;
  opacity: 0.5;
}

@keyframes lettersMove {
  0% { transform: translate(0,0); }
  100% { transform: translate(-50%, -50%); }
}

/* ===== Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Card ===== */
.card {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  
  width: 95%;
  max-width: 420px;
  height: auto;        /* â† Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø§Ù„ØªÙˆØ³Ø¹ */
  max-height: 85vh;    /* â† Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© */

  padding: 16px;
  border-radius: 26px;
  background: linear-gradient(to bottom, #0000ff, #008000, #ffff00);

  display: flex;
  flex-direction: column;
  overflow-y: auto;    /* â† Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø·ÙˆÙŠÙ„ØŒ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙ…Ø±ÙŠØ± */
  overflow-x: hidden;

  z-index: 10;
}
.stage-key {
  flex: 0 0 calc((100% - 24px*2)/3); /* Ø­Ø¬Ù… ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© */
  height: 90px;
  background: #1e293b;
  color: #fff;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  cursor: pointer;
  scroll-snap-align: start;
}
.stage-key.locked {
  opacity: .35;
  pointer-events: none;
  position: relative;
}
.stage-key.locked::after {
  content:"ğŸ”’";
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
}

/* ===== SECTIONS ===== */
.section{
 display:none;
 opacity:0;
 transform:translateY(16px) scale(.97);
 pointer-events:none;
 transition: opacity .35s ease, transform .35s cubic-bezier(.4,0,.2,1);
}
.section.active{
 display:block;
 opacity:1;
 transform:translateY(0) scale(1);
 pointer-events:auto;
}

/* ===== BUTTONS ===== */
.btn{
 width:100%;min-height:52px;margin:8px 0;border:none;border-radius:16px;
 font-size:18px;font-weight:700;cursor:pointer;
 transition:all .3s ease;
}
.btn-main {
  background: linear-gradient(135deg, #ff0000, #ff8c00);
  color: #fff;;
}
.btn-back{
 background:linear-gradient(135deg,#0f172a,#334155);
 color:#fff;
 border:1px solid #334155;
}
.btn:hover{
 box-shadow:0 4px 15px rgba(0,0,0,0.4);
 transform:scale(1.03);
}

/* ===== SETTINGS ===== */
.setting-item{
 display:flex;justify-content:space-between;align-items:center;
 background:#0f172a;border:1px solid #334155;
 border-radius:14px;padding:14px;margin:10px 0;
 font-size:18px;
}
.toggle{
 width:52px;height:28px;border-radius:20px;
 background:#334155;position:relative;cursor:pointer;
}
.toggle::after{
 content:"";position:absolute;top:4px;right:4px;
 width:20px;height:20px;border-radius:50%;
 background:#fff;transition:.3s;
}
.toggle.on{background:var(--accent)}
.toggle.on::after{right:28px}

/* ===== ANSWER BOXES ===== */
.answer-boxes{
 display:flex;justify-content:center;gap:8px;margin:12px 0;direction:ltr;
}
.answer-box{
 width:44px;height:44px;border-radius:10px;
 background:#fff;color:#000;
 display:flex;align-items:center;justify-content:center;font-size:22px;
 transition:all .3s ease;
}
.answer-box.ok{
 background:linear-gradient(135deg,#22c55e,#4ade80);
 color:#fff;
}
.answer-box.bad{
 background:linear-gradient(135deg,#ef4444,#f87171);
 color:#fff;
}
.question-text{
  display:none;
  margin:12px 0;
  font-size:18px;
  line-height:1.7;
  font-weight:600;
  text-align:center;
}
/* ===== KEYBOARD ===== */
.keyboard {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4 Ø£Ø¹Ù…Ø¯Ø© Ù„ÙƒÙ„ ØµÙ */
  gap: 10px; /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø­Ø±ÙˆÙ */
}

/* ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ ØªØ¹Ø±ÙŠÙ Ù…Ø«Ù„Ø« Ù„Ø£Ù†Ù‡ ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… */
.key{
 background:#1e293b;
 padding:14px;
 border-radius:14px;
 text-align:center;
 font-size:22px;
 font-weight:bold;
 cursor:pointer;
 touch-action:none; 
 transition:transform .08s ease, box-shadow .3s ease, background .3s ease;
}
.key.locked{
 position:relative;
 opacity:.35;
 pointer-events:none;
}
.key.locked::after{
 content:"ğŸ”’";
 position:absolute;
 inset:0;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:26px;
}
.key.used{opacity:.25;pointer-events:none}
.key.shake{
 animation:shake .3s;
}
.key:active{
 transform:scale(0.92);
 box-shadow:0 4px 10px rgba(0,0,0,0.3);
}
.key:hover:not(.locked){
 background:linear-gradient(135deg,#334155,#1e293b);
 box-shadow:0 4px 12px rgba(0,0,0,0.4);
}
@keyframes shake{
 0%{transform:translateX(0)}
 25%{transform:translateX(-4px)}
 50%{transform:translateX(4px)}
 75%{transform:translateX(-4px)}
 100%{transform:translateX(0)}
}
/* ===== HEXAGON MODE ===== */
.hexagon{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:12px;
  justify-items:center;
}

.hex-cell{
  width:64px;
  height:56px;
  background:#1e293b;
  clip-path: polygon(
    25% 0%,
    75% 0%,
    100% 50%,
    75% 100%,
    25% 100%,
    0% 50%
  );
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  font-weight:bold;
  cursor:pointer;
  transition:transform .15s ease, background .3s ease;
}

.hex-cell:active{
  transform:scale(0.9);
}

.hex-cell:hover{
  background:linear-gradient(135deg,#334155,#1e293b);
}
/* ===== WHEEL ===== */
.wheel{
 width:260px;height:260px;margin:16px auto;
 border-radius:50%;
 border:3px solid var(--accent);
 position:relative;
 background: conic-gradient(from 0deg, #facc15, #ffea00, #22c55e, #4ade80, #facc15);
 animation: wheelRotate 10s linear infinite;
}
@keyframes wheelRotate {
  0%{transform:rotate(0deg);}
  100%{transform:rotate(360deg);}
}
.wheel .key{
 width:52px;height:52px;border-radius:50%;
 background:var(--accent);color:#000;
 position:absolute;display:flex;align-items:center;justify-content:center;
 transition:all .3s ease, transform .2s ease;
}
.wheel .key:hover{
 transform:scale(1.2);
 box-shadow:0 6px 15px rgba(0,0,0,0.4);
}

/* ===== DELETE BUTTON ===== */
.delete{
 background:#0f172a;border:1px solid #334155;
 border-radius:14px;padding:14px;font-size:20px;font-weight:bold;cursor:pointer;
 transition:all .3s ease;
}
.delete:hover{
 box-shadow:0 4px 12px rgba(0,0,0,0.3);
 transform:scale(1.05);
}

/* ===== OVERLAY & WIN ===== */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}
.overlay.active{display:flex}
.win{
 background:#020617;padding:26px;border-radius:22px;
 box-shadow:0 0 60px var(--accent);text-align:center;
}

/* ===== CONFETTI ===== */
.confetti{
 position:fixed;
 top:-20px;
 font-size:26px;
 animation:fall linear forwards;
 pointer-events:none;
 z-index:2000; /* ÙÙˆÙ‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ù€ overlay */
 color: #facc15;
}
.confetti:nth-child(odd){color:#22c55e;}
.confetti:nth-child(even){color:#ff4444;}
@keyframes fall{
 to{
  transform:translateY(120vh) rotate(720deg) rotateX(360deg);
  opacity:0;
 }
}
#finalOverlay .win{
  width:90%;
  max-width:420px;
  padding:36px;
  border-radius:26px;
  box-shadow:0 0 120px var(--accent);
  animation:finalPop .6s ease-out;
}

@keyframes finalPop{
  from{
    transform:scale(.6);
    opacity:0;
  }
  to{
    transform:scale(1);
    opacity:1;
  }
}

/* ===== MAP GRID SCROLL & SNAP ===== */
#mapGrid {
  display: flex;
  gap: 12px;

  overflow-x: auto;
  overflow-y: hidden;

  scroll-snap-type: x mandatory;
  padding: 10px;

  flex: 1;        /* â† Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…ÙØªØ§Ø­ */
}
.key {
  flex: 0 0 calc((100% - 24px*2)/3); /* Ø¹Ø±Ø¶ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© */
  height: 90px;
  /* Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙƒÙ…Ø§ Ù‡Ùˆ */
}
  
  background: #1e293b;
  color: #fff;
  border-radius: 14px;

  display: flex;
  align-items: center;
  justify-content: center;

  font-weight: bold;
  cursor: pointer;
  scroll-snap-align: start;  /* Ø§Ù„Ø§Ù„ØªØµØ§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
}

</style>
</head>

<body>

<div class="card">
<div id="menu" class="section active">
 <h1>âµ£Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ùˆ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©âµ£</h1>
 <button class="btn btn-main" onclick="openMap()">â–¶ï¸ â´±â´·â´° Ø¨Ø¯Ø¡</button>

 <button class="btn btn-back" onclick="show('settings')">ğŸ”§ settings</button>
<button class="secondary-btn" onclick="openHowTo()">â„¹ ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨</button>
</div>
<div id="settings" class="section">
 <h1>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>

 <div class="setting-item">
 <span id="soundLabel">ğŸ”Š Ø§Ù„ØµÙˆØª</span>
  <div id="soundToggle" class="toggle"></div>
 </div>

<div class="setting-item">
 <span id="vibeLabel">ğŸ“³ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²</span>
  <div id="vibeToggle" class="toggle"></div>
</div>

<div class="setting-item">
  <span>ğŸŒ Ø§Ù„Ù„ØºØ©</span>
  <select onchange="setLang(this.value)">
    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    <option value="en">English</option>
    <option value="am">âµœâ´°âµâ´°âµ£âµ‰âµ–âµœ</option>
  </select>
</div>

<button class="btn btn-back" onclick="show('menu')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>  
</div>  <div id="map" class="section">  
 <h1>â­ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</h1>  
<div id="mapGrid"></div>
 <button class="btn btn-back" onclick="show('menu')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<div id="game" class="section">
 <h1 id="levelTitle"></h1>
 <img id="questionImg">
<div id="questionText" class="question-text"></div>
 <!-- ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© -->
 <div class="answer-boxes" id="boxes"></div>

 <!-- Ø²Ø± Ø§Ù„ØªÙ„Ù…ÙŠØ­ ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯ -->
 <button class="btn btn-back" id="hintBtn">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
 <div id="hintCount">3</div>

 <!-- Ø¹Ø¬Ù„Ø© Ø§Ù„Ø£Ø­Ø±Ù -->
 <div id="wheel" class="wheel"></div>

 <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ -->
 <div id="keyboard" class="keyboard"></div>

 <!-- Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®Ø±ÙŠØ·Ø© -->
 <button class="btn btn-back" onclick="show('map')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<div id="overlay" class="overlay">
 <div class="win"><h2>ğŸ”¥ Ø£Ø­Ø³Ù†Øª ğŸ”¥</h2></div>
</div>
<div id="finalOverlay" class="overlay">
 <div class="win">
  <h2>ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! ğŸ†</h2>
  <p>Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¨Ù†Ø¬Ø§Ø­</p>
  <button class="btn btn-main" onclick="finalOverlay.classList.remove('active'); show('menu');">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
</div>
</div>
<div id="stageOverlay" class="overlay">
 <div class="win">
  <h2>âœ¨ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø© âœ¨</h2>
  <div id="starsView" style="font-size:32px;margin:12px 0"></div>
  <button class="btn btn-main" id="nextStageBtn">â–¶ï¸ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
  <button class="btn btn-back" onclick="show('map'); stageOverlay.classList.remove('active')">ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
 </div>
</div>
<div id="howToBox" class="overlay" style="display:none">
  <div class="overlay-content">
    <h2>ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨ How to Play </h2>

    <p>
This Amazigh words and puzzles game aims to test your knowledge and enrich your vocabulary in a fun way.
      Ù‡Ø°Ù‡ Ù„Ø¹Ø¨Ø© ÙƒÙ„Ù…Ø§Øª ÙˆØ£Ù„ØºØ§Ø² Ø£Ù…Ø§Ø²ÙŠØºÙŠØ© ØªÙ‡Ø¯Ù Ø¥Ù„Ù‰ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ
      ÙˆØªÙ†Ù…ÙŠØ© Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ù„ØºÙˆÙŠ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ù…ØªØ¹Ø©.

    </p>

    <ul>
      <li>Read the question or look at the image carefully.
</li>
<li>Ø§Ù‚Ø±Ø£ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø´Ø§Ù‡Ø¯ Ø§Ù„ØµÙˆØ±Ø© Ø¬ÙŠØ¯Ù‹
</li>
      <li>Drag the letters to form the correct word. </li>
<li>Ø§Ø³Ø­Ø¨ Ø§Ù„Ø­Ø±ÙˆÙ Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
</li>
      <li> Each correct answer earns you stars â­.</li>
<li>ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ØªÙ…Ù†Ø­Ùƒ Ù†Ø¬ÙˆÙ… â­.</li>
      <li>Use stars to request a hint.</li>
 <li>ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„Ù†Ø¬ÙˆÙ… Ù„Ø·Ù„Ø¨ ØªÙ„Ù…ÙŠØ­</li>
      <li>Your progress is saved automatically.</li>
<li>ØªÙ‚Ø¯Ù‘Ù…Ùƒ ÙŠÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</li>
</ul>
    <p class="note">
       âµ£ Beta version by Azeddin Bouhouti â€“ New Year's Competition 
âµ£ âµ£Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø¹Ø²Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¨Ø­ÙˆØªÙŠ â€“ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø±Ø£Ø³ Ø§Ù„Ø³Ù†Ø© âµ£
    </p>

    <button onclick="closeHowTo()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>
<script>
function openHowTo(){
  document.getElementById("howToBox").style.display = "flex";
}

function closeHowTo(){
  document.getElementById("howToBox").style.display = "none";
}
let stars = JSON.parse(localStorage.getItem("amazighStars") || "[]");
const boxes = document.getElementById("boxes");
const keyboard = document.getElementById("keyboard");
const wheel = document.getElementById("wheel");
const mapGrid = document.getElementById("mapGrid");
const levelTitle = document.getElementById("levelTitle");
const questionImg = document.getElementById("questionImg");
const questionText = document.getElementById("questionText");
/* ===== LANGUAGE ===== */
let currentLang = localStorage.getItem("lang") || "ar";

function setLang(l){
  currentLang = l;
  localStorage.setItem("lang", l);
  applyLang();
}
function applyLang(){
  const t = translations[currentLang];

  /* ===== Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ===== */
  const menuTitle = document.querySelector("#menu h1");
  if(menuTitle) menuTitle.textContent = t.title;

  const settingsTitle = document.querySelector("#settings h1");
  if(settingsTitle) settingsTitle.textContent = t.settings;

  /* ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ===== */
  const startBtn = document.querySelector(".btn-main");
  if(startBtn) startBtn.textContent = t.start;

  const settingsBtn = document.querySelector("button[onclick=\"show('settings')\"]");
  if(settingsBtn) settingsBtn.textContent = t.settingsBtn;
const soundLabel = document.getElementById("soundLabel");
if(soundLabel) soundLabel.textContent = t.sound;

const vibeLabel = document.getElementById("vibeLabel");
if(vibeLabel) vibeLabel.textContent = t.vibe;
  const howToBtn = document.querySelector(".secondary-btn");
  if(howToBtn) howToBtn.textContent = t.howToBtn;

  /* ===== Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© ===== */
  const langLabel = document.querySelector("#settings select")?.previousElementSibling;
  if(langLabel) langLabel.textContent = t.langLabel;

  /* ===== â­ Ø¹Ù†ÙˆØ§Ù† Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø±Ø§Ø­Ù„ ===== */
  const mapTitle = document.querySelector("#map h1");
  if(mapTitle) mapTitle.textContent = t.stagesTitle;

  /* ===== ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø­Ù„ ===== */
  if(typeof mapGrid !== "undefined" && mapGrid){
    const keys = mapGrid.querySelectorAll(".key, .stage-key");
    keys.forEach((key,i)=>{
      const stageDiv = key.querySelector("div:first-child");
      if(stageDiv) stageDiv.textContent = `${t.stage} ${i+1}`;
    });
  }

  /* ===== â¬…ï¸ Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ ===== */
  document.querySelectorAll(".btn-back").forEach(btn=>{
    btn.textContent = t.back;
  });

  /* ===== overlays ===== */
  const winTitle = document.querySelector("#overlay h2");
  if(winTitle) winTitle.textContent = t.win;

  const stageOverlayTitle = document.querySelector("#stageOverlay h2");
  if(stageOverlayTitle) stageOverlayTitle.textContent = t.stageEnd || t.win;

  const finalTitle = document.querySelector("#finalOverlay h2");
  if(finalTitle) finalTitle.textContent = t.final;

  const finalBtn = document.querySelector("#finalOverlay button");
  if(finalBtn && t.finalMenu) finalBtn.textContent = t.finalMenu;

  /* ===== Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø¥Ù† ÙˆØ¬Ø¯) ===== */
  if(typeof questionText !== "undefined" && questionText){
    questionText.textContent = t.question || "";
  }
}
const translations = {
  ar: {
    title: "âµ£Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ùˆ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©âµ£",
    start: "â–¶ï¸ Ø¨Ø¯Ø¡",
    settings: "âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
    settingsBtn: "ğŸ”§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
    howToBtn: "â„¹ ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨",
    langLabel: "ğŸŒ Ø§Ù„Ù„ØºØ©",
    stage: "Ù…Ø±Ø­Ù„Ø©",
    stagesTitle: "â­ Ø§Ù„Ù…Ø±Ø§Ø­Ù„",
    back: "â¬…ï¸ Ø±Ø¬ÙˆØ¹",
    win: "ğŸ”¥ Ø£Ø­Ø³Ù†Øª ğŸ”¥",
    final: "ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! ğŸ†",
    sound: "ğŸ”Š Ø§Ù„ØµÙˆØª",
    vibe: "ğŸ“³ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²",
  },

  en: {
    title: "âµ£ Amazigh Word Game âµ£",
    start: "â–¶ï¸ Start",
    settings: "âš™ï¸ Settings",
    settingsBtn: "ğŸ”§ Settings",
    howToBtn: "â„¹ How to Play",
    langLabel: "ğŸŒ Language",
    stage: "Stage",
    stagesTitle: "â­ Stages",
    back: "â¬…ï¸ Back",
    win: "ğŸ”¥ Well done ğŸ”¥",
    final: "ğŸ† Congratulations! ğŸ†",
    sound: "ğŸ”Š Sound",
    vibe: "ğŸ“³ Vibration",
  },

  am: {
    title: "âµ£ âµœâ´°âµâ´°âµ£âµ‰âµ–âµœ âµ£",
    start: "â–¶ï¸ â´±â´·â´°",
    settings: "âš™ï¸ âµœâµ‰âµ™âµâµ‰âµâµ‰âµ",
    settingsBtn: "ğŸ”§ âµœâµ‰âµ™âµâµ‰âµâµ‰âµ",
    howToBtn: "â„¹ âµœâ´°âµ™â´½â´°âµ¡âµœ",
    langLabel: "ğŸŒ âµœâµ‰âµ™â´½âµâµ“âµ",
    stage: "âµ–â´°âµ”â´°",
    stagesTitle: "â­ âµ‰âµ–â´°âµ”â´°âµ",
    back: "â¬…ï¸ âµ”âµ”â´°âµŠâµ“",
    win: "ğŸ”¥ â´°âµ¢âµ¢âµ“âµ£ ğŸ”¥",
    final: "ğŸ† â´°âµ¢âµ¢âµ“âµ£! ğŸ†",
    sound: "ğŸ”Š â´°âµ™âµ™âµ“âµ",
    vibe: "ğŸ“³ â´°âµâµ£âµ£âµ“âµ£",
  }
};

const overlay = document.getElementById("overlay");
const stageOverlay = document.getElementById("stageOverlay");
const finalOverlay = document.getElementById("finalOverlay");
const starsView = document.getElementById("starsView");
const nextStageBtn = document.getElementById("nextStageBtn");
const hintBtn   = document.getElementById("hintBtn");
const hintCount = document.getElementById("hintCount");
/* ===== Ù‡Ù†Ø§ Ù†Ø²ÙŠØ¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© ===== */
let stage = 0, q = 0, input = [], drag = false;
let hintsLeft = 3, hintsUsed = 0;  // âœ… Ù‡Ù†Ø§ ÙÙ‚Ø·
/* ===== SETTINGS ===== */
let soundOn = localStorage.getItem("soundOn") !== "0";
let vibeOn  = localStorage.getItem("vibeOn")  !== "0";

/* ğŸ”Š ØµÙˆØª Ø§Ù„ØªØµÙÙŠÙ‚ */
const applauseSound = new Audio("applause.mp3");

const soundToggle = document.getElementById("soundToggle");
const vibeToggle  = document.getElementById("vibeToggle");

function syncToggles(){
 soundToggle.classList.toggle("on",soundOn);
 vibeToggle.classList.toggle("on",vibeOn);
}
soundToggle.onclick=()=>{
 soundOn=!soundOn;
 localStorage.setItem("soundOn",soundOn?1:0);
 syncToggles();
};
vibeToggle.onclick=()=>{
 vibeOn=!vibeOn;
 localStorage.setItem("vibeOn",vibeOn?1:0);
 syncToggles();
};
syncToggles();

/* ===== SOUND (synthetic clap) ===== */
let ctx;
function clap(){
 if(!soundOn) return;
 if(!ctx) ctx=new (window.AudioContext||window.webkitAudioContext)();
 for(let i=0;i<6;i++){
  const o=ctx.createOscillator(),g=ctx.createGain();
  o.type="square"; o.frequency.value=200+Math.random()*400;
  g.gain.setValueAtTime(.5,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.15);
  o.connect(g).connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+.15);
 }
 if(vibeOn && navigator.vibrate) navigator.vibrate([80,40,80]);
}
/* ===== DATA (10 Ù…Ø±Ø§Ø­Ù„ Ã— 3 Ø£Ø³Ø¦Ù„Ø©) ===== */
const stages = [
  {qs:[
    {a:"âµœâ´°âµâµâµ“âµ”âµœ", shape:"grid", img:null, text:{
      ar:"ØªØ¹Ù†ÙŠ Ø§Ù„Ø£Ø±Ø¶ Ø£Ùˆ Ø§Ù„ÙˆØ·Ù†",
      en:"Means land or homeland",
      am:"âµœâ´°âµâµâµ“âµ”âµœ"
    }},
    {a:"â´°â´½â´°âµ", shape:"grid", img:null, text:{
      ar:"ÙƒÙ„ Ù…Ø§ Ù‡Ùˆ ØªØ±Ø§Ø¨ ÙˆØ·Ø¨ÙŠØ¹Ø©",
      en:"Everything that is soil and nature",
      am:"â´°â´½â´°âµ"
    }},
    {a:"âµœâ´°â´¼âµ“âµ›âµœ", shape:"circle", img:"thafucth.jpg"}
  ]},

  {qs:[
    {a:"â´°â´·âµ”â´°âµ”", shape:"circle", img:"mountain.jpg"},
    {a:"â´°âµ™âµ‰â´¼", shape:"grid", img:"river.jpg"},
    {a:"â´±â´»âµâµâ´°âµ„âµâ´°âµ", shape:"grid", img:"flower.jpg"}
  ]},

  {qs:[
    {a:"â´·âµŠâ´°âµ¡âµ£", shape:"circle", img:"flowers.jpg"},
    {a:"â´°âµâ´°âµ", shape:"hexagon", img:null, text:{
      ar:"Ù…Ø§Ø¡",
      en:"Water",
      am:"â´°âµâ´°âµ"
    }},
    {a:"âµ‰âµâ´°âµâ´·âµ‰", shape:"grid", img:null, text:{
      ar:"Ø£Ø³Ø§Ø³ÙŠ ÙÙŠ Ø§Ù„ØªØºØ°ÙŠØ©",
      en:"Essential for nutrition",
      am:"âµ‰âµâ´°âµâ´·âµ‰"
    }}
  ]},

  {qs:[
    {a:"â´°â´½â´°âµ", shape:"circle", img:null, text:{
      ar:"Ø·Ø¹Ø§Ù…",
      en:"Food",
      am:"â´°â´½â´°âµ"
    }},
    {a:"âµœâ´°âµ£âµ‰âµ”âµ‰", shape:"hexagon", img:"thaziri.jpg"},
    {a:"â´°âµ¢âµ¢âµ“âµ”", shape:"grid", img:"ayur.jpg"}
  ]},

  {qs:[
    {a:"âµ‰âµœâµ”â´°âµ", shape:"circle", img:"stars.jpg"},
    {a:"âµœâ´°âµâ´°âµ£âµ–â´°", shape:"hexagon", img:"tamazgha.jpg"},
    {a:"â´°âµ”â´°â´±âµ“âµ£", shape:"grid", img:"araboz.jpg"}
  ]},

  {qs:[
    {a:"âµœâµ“âµœâ´»âµâµâ´°âµ¢âµœ", shape:"grid", img:null, text:{
      ar:"ÙƒÙ„ Ù…Ø§ Ù‡Ùˆ Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„ÙƒÙ„Ø§Ù…",
      en:"Everything related to speech",
      am:"âµœâµ“âµœâ´»âµâµâ´°âµ¢âµœ"
    }},
    {a:"âµœâ´°âµâµâµ“âµ”âµœ", shape:"hexagon", img:"riddle2.jpg"},
    {a:"â´°âµâ´°âµ£âµ‰âµ–", shape:"circle", img:"riddle3.jpg"}
  ]},

  {qs:[
    {a:"âµœâ´°âµ”âµ‰â´¼â´°âµ›âµœ", shape:"grid", img:null, text:{
      ar:"Ù…Ù† ÙØ±ÙˆØ¹ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©",
      en:"A branch of Amazigh language",
      am:"âµœâ´°âµ”âµ‰â´¼â´°âµ›âµœ"
    }},
    {a:"â´°âµâ´°âµ£âµ‰âµ–", shape:"hexagon", img:null, text:{
      ar:"Ø§Ø³Ù… Ø§Ù„Ø´Ø¹Ø¨ Ø§Ù„Ø­Ø±",
      en:"Name of the free people",
      am:"â´°âµâ´°âµ£âµ‰âµ–"
    }},
    {a:"â´°âµ£âµ“âµ", shape:"circle", img:null, text:{
      ar:"Ø§Ù„ØªØ­ÙŠØ© Ø¨Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©",
      en:"Greeting in Amazigh",
      am:"â´°âµ£âµ“âµ"
    }}
  ]},

  {qs:[
    {a:"â´°âµ¢âµ“âµ”", shape:"hexagon", img:"moon.jpg"},
    {a:"iá¹­ran", shape:"circle", img:"stars.jpg"},
    {a:"âµœâµ‰â´¼âµ‰âµâ´°âµ–", shape:"grid", img:null, text:{
      ar:"Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©",
      en:"Amazigh writing",
      am:"âµœâµ‰â´¼âµ‰âµâ´°âµ–"
    }}
  ]},

  {qs:[
    {a:"âµâ´°âµ™âµ‰âµâµ‰âµ™â´°", shape:"grid", img:null, text:{
      ar:"Ù…Ù„Ùƒ Ø£Ù…Ø§Ø²ÙŠØºÙŠ ÙˆØ­Ù‘Ø¯ Ù†ÙˆÙ…ÙŠØ¯ÙŠØ§ ÙˆÙ‚Ø§ÙˆÙ… Ø§Ù„Ø±ÙˆÙ…Ø§Ù†",
      en:"Amazigh king who united Numidia and resisted Romans",
      am:"âµâ´°âµ™âµ‰âµâµ‰âµ™â´°"
    }},
    {a:"âµ¢âµ“â´³âµ“âµ”âµœâ´°", shape:"hexagon", img:"jugurtha.jpg"},
    {a:"âµœâ´°âµâ´°âµ£âµ‰âµ–âµœ", shape:"circle", img:null, text:{
      ar:"Ø§Ø³Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©",
      en:"Name of Amazigh language",
      am:"âµœâ´°âµâ´°âµ£âµ‰âµ–âµœ"
    }}
  ]},

  {qs:[
    {a:"âµœâµ‰âµ€âµ¢â´°", shape:"circle", img:"dihya.jpg"},
    {a:"âµâµ“âµâµ‰â´·âµ¢â´°", shape:"grid", img:null, text:{
      ar:"Ù…Ù…Ù„ÙƒØ© Ø£Ù…Ø§Ø²ÙŠØºÙŠØ© Ù‚Ø¯ÙŠÙ…Ø© ÙÙŠ Ø´Ù…Ø§Ù„ Ø¥ÙØ±ÙŠÙ‚ÙŠØ§",
      en:"Ancient Amazigh kingdom in North Africa",
      am:"âµâµ“âµâµ‰â´·âµ¢â´°"
    }},
    {a:"â´°âµ£â´°", shape:"hexagon", img:null, text:{
      ar:"Ø±Ù…Ø² Ø§Ù„Ø­Ø±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØº",
      en:"Symbol of freedom among Amazigh",
      am:"â´°âµ£â´°"
    }}
  ]}
];

let unlocked=+localStorage.getItem("amazighUnlocked")||0;

const symbols=["ğŸ¤—","ğŸ¤©","ğŸ‘","ğŸ‘","ğŸ‘","ayuuz","â´°âµ¢âµ¢âµ“âµ£","ğŸŒ¸","ğŸŒº","â¤ï¸","ğŸ’–","ğŸ’","âµ£","âµ‰","âµœ","â´°","ğŸŒ¸","ğŸŒº","ğŸŒ¹","ğŸƒ","ğŸƒ","ğŸŒ·","ğŸŒ¼","ğŸŒ»","âš˜","ğŸˆ","ğŸˆ","ğŸ’µ","ğŸ’¶","ğŸ’¸","âœ”","âœ…"];
function celebrate(final=false){
  clap();

  for(let i=0;i<25;i++){
    const c=document.createElement("div");
    c.className="confetti";
    c.textContent=symbols[Math.floor(Math.random()*symbols.length)];
    c.style.left=Math.random()*100+"vw";
    c.style.animationDuration=2+Math.random()*2+"s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),4000);
  }
}
function show(id){
 document.querySelectorAll(".section").forEach(s=>{
  s.classList.remove("active");
  s.style.display = "none";
 });

 document.body.offsetHeight; // â† Ù…Ù‡Ù…

 const el = document.getElementById(id);
 el.style.display = "block";

 requestAnimationFrame(()=>{
  el.classList.add("active");
 });

}
function openMap(){
  mapGrid.innerHTML = "";

  stages.forEach((_,i)=>{
    const d = document.createElement("div");
  d.className = "stage-key" + (i > unlocked ? " locked" : "");
    const s = stars[i] || 0;
    d.innerHTML = `
     <div>${translations[currentLang].stage} ${i+1}</div>
      <div style="font-size:16px">
        ${"â­".repeat(s)}${"â˜†".repeat(3-s)}
      </div>
    `;
    if(i <= unlocked) d.onclick = ()=>startStage(i);

    mapGrid.appendChild(d);
  });

  show("map");
}

function startStage(i){
 stage = i;
 q = 0;
 hintsLeft = 3;
 hintsUsed = 0;
 startQuestion();
}
hintBtn.onclick = ()=>{
  if(hintsLeft <= 0) return alert("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØªÙ„Ù…ÙŠØ­Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©!");

  const L = stages[stage].qs[q];
  const used = input.map(k=>k.dataset.ch);
  const next = [...L.a].find(ch=>!used.includes(ch));
  if(!next) return;

  const box = boxes.children[input.length];
  box.textContent = next;

  const keyEl = [...keyboard.children].find(
    k=>k.dataset?.ch===next && !k.classList.contains("used")
  );
  if(keyEl) keyEl.classList.add("used");

  input.push(keyEl || {dataset:{ch:next}});

  hintsLeft--;
  hintsUsed++;
  hintCount.textContent = hintsLeft;

  refresh();
  if(input.length===L.a.length) check(L);
};
// ===== CORE GAME FUNCTIONS (Ø§Ù„Ù†Ø§Ù‚ØµØ©) =====

function startQuestion(){
  input = [];
  drag = false;

  const L = stages[stage].qs[q];
hintCount.textContent = hintsLeft;
  levelTitle.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${stage+1} â€” Ø³Ø¤Ø§Ù„ ${q+1}/${stages[stage].qs.length}`;

  if(L.img){
    questionImg.style.display = "block";
    questionImg.src = L.img;
  } else {
    questionImg.style.display = "none";
  }

  renderBoxes(L);
questionText.style.display = L.text ? "block" : "none";  // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡
questionText.textContent = L.text && typeof L.text === "object"
    ? (L.text[currentLang] || L.text.ar)
    : L.text || "";  // Ù†Øµ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„ØºØ§Øª Ø£Ùˆ Ù†Øµ Ø¹Ø±Ø¨ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠ
  renderBoard(L);

  show("game");
}
function check(L){
  const answer = input.map(k=>k.dataset.ch).join("");
  if(answer !== L.a){
    document.querySelectorAll(".answer-box")
      .forEach(b=>b.classList.add("bad"));
    return;
  }

  document.querySelectorAll(".answer-box")
    .forEach(b=>b.classList.add("ok"));
  celebrate();

  q++;

  if(q < stages[stage].qs.length){
    setTimeout(startQuestion, 800);
  } else {
    // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø©
    stars[stage] = Math.max(stars[stage] || 0, 3 - hintsUsed);
    localStorage.setItem("amazighStars", JSON.stringify(stars));

    if(stage === unlocked){
      unlocked++;
      localStorage.setItem("amazighUnlocked", unlocked);
    }

    if(stage + 1 < stages.length){
      stageOverlay.classList.add("active");
      nextStageBtn.onclick = ()=>{
        stageOverlay.classList.remove("active");
        startStage(stage+1);
      };
    } else {
      celebrate(true);
      finalOverlay.classList.add("active");
    }
  }
}
function renderBoxes(L){
  boxes.innerHTML = "";
  for(let i=0;i<L.a.length;i++){
    boxes.innerHTML += `<div class="answer-box"></div>`;
  }
}

function makeKey(ch){
  const k = document.createElement("div");
  k.className = "key";
  k.textContent = ch;
  k.dataset.ch = ch;
  return k;
}

function pick(el,L){
  if(el.classList.contains("used") || input.length>=L.a.length) return;
  el.classList.add("used");
  if(vibeOn && navigator.vibrate) navigator.vibrate(20);
  input.push(el);
  refresh();
  if(input.length===L.a.length) check(L);
}

function removeLast(){
  if(!input.length) return;
  const last = input.pop();
  if(last) last.classList.remove("used");
  refresh();
}

function renderBoard(L){
  keyboard.innerHTML = "";
  wheel.innerHTML = "";
  keyboard.style.display = "none";
  wheel.style.display = "none";

  const letters = [...L.a].sort(()=>Math.random()-.5);

  if(L.shape==="circle"){
    wheel.style.display="block";
    const r=110, c=130;
    letters.forEach((ch,j)=>{
      const a = 2*Math.PI*j/letters.length;
      const k = makeKey(ch);
      k.style.left = c+r*Math.cos(a)-26+"px";
      k.style.top  = c+r*Math.sin(a)-26+"px";
      wheel.appendChild(k);
    });
  } else {
    keyboard.style.display="grid";
    keyboard.className = L.shape==="hexagon"?"hexagon":"keyboard";
    letters.forEach(ch=>{
      const k = makeKey(ch);
      k.addEventListener("click", ()=>pick(k,L));
      if(L.shape==="hexagon") k.classList.add("hex-cell");
      keyboard.appendChild(k);
    });

    const del = document.createElement("div");
    del.className = "delete";
    del.textContent = "âŒ«";
    del.onclick = removeLast;
    keyboard.appendChild(del);
  }
}

// ===== DRAG FOR CIRCLE =====
wheel.addEventListener("pointerdown", e=>{
  const L = stages[stage].qs[q];
  if(L.shape!=="circle") return;
  input=[];
  drag=true;
  dragPick(e,L);
});
wheel.addEventListener("pointermove", e=>{
  if(!drag) return;
  const L = stages[stage].qs[q];
  dragPick(e,L);
});
document.addEventListener("pointerup", ()=>{
  if(!drag) return;
  drag=false;
  const L = stages[stage].qs[q];
  if(input.length!==L.a.length) setTimeout(()=>startQuestion(),100);
  else check(L);
});
function dragPick(e,L){
  const el = document.elementFromPoint(e.clientX,e.clientY);
  if(el && el.classList.contains("key")) pick(el,L);
}

function refresh(){
  document.querySelectorAll(".answer-box").forEach((b,i)=>{
    b.textContent = input[i]?.dataset.ch||"";
    b.className="answer-box";
  });
}
applyLang();
</script>
</body>
</html>
