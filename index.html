<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title> âµ£Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ùˆ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©âµ£</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{--accent:#facc15}
*{box-sizing:border-box}

/* ===== BODY & BACKGROUND ===== */
body {
  margin: 0;
  font-family: 'Almarai', sans-serif;
  color: #fff;

  min-height: 100vh;
  /* ğŸ‘‡ Ù†Ø³Ù…Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ø°Ø§ Ø§Ø­ØªØ¬Ù†Ø§ */
  overflow: auto;
  position: relative;

  background: linear-gradient(180deg, #0055A4 0%, #FFD700 50%, #008A00 100%);
  background-size: 200% 200%;
  animation: bgMove 20s linear infinite, bgColorShift 40s ease-in-out infinite alternate;
}

@keyframes bgMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes bgColorShift {
  0% { background: linear-gradient(180deg, #0055A4 0%, #FFD700 50%, #008A00 100%); }
  25% { background: linear-gradient(180deg, #0060B0 0%, #FFDE00 50%, #009000 100%); }
  50% { background: linear-gradient(180deg, #004C99 0%, #FFCC00 50%, #007700 100%); }
  75% { background: linear-gradient(180deg, #0055A4 0%, #FFD700 50%, #008A00 100%); }
  100% { background: linear-gradient(180deg, #0055A4 0%, #FFD700 50%, #008A00 100%); }
}

/* ===== AMAZIGH LETTERS IN BACKGROUND ===== */
body::before {
  content: '';
  position: fixed; /* ğŸ‘ˆ Ø«Ø§Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© */
  top: 0; left: 0;
  width: 200%; height: 200%;
  background: transparent url('data:image/svg+xml;utf8,\
<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12">\
<text x="0" y="12" font-size="12" fill="white">â´°â´±â´·â´¹â´»â´¼â´½âµ€âµƒâµ„âµ…âµ‡âµ‰âµŠâµ‹</text>\
</svg>') repeat;
  background-size: 40px 40px;
  animation: lettersMove 60s linear infinite;
  pointer-events: none;
  z-index:1;
  opacity:0.5;
}

@keyframes lettersMove {
  0% { transform: translate(0,0); }
  100% { transform: translate(-50%, -50%); }
}

/* ===== CARD & MENU ===== */
.card{
 width:95%;
 max-width:420px;
 background:#020617;
 border-radius:26px;
 padding:20px;
 box-shadow:0 0 0 2px var(--accent),0 30px 60px rgba(0,0,0,.7);
 position: fixed;
 top: 50%;
 left: 50%;
 transform: translate(-50%, -50%);
 z-index: 10; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† ÙƒÙ„ Ø´ÙŠØ¡ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø«Ø¨Ø§Øª */
 transition: transform 0.35s cubic-bezier(.4,0,.2,1), opacity 0.35s ease;
}
h1{text-align:center;color:var(--accent);margin:6px 0}
img{width:100%;border-radius:16px;margin:10px 0}

/* ===== SECTIONS ===== */
.section{
 display:none;
 opacity:0;
 transform:translateY(16px) scale(.97);
 pointer-events:none;
 transition: opacity .35s ease, transform .35s cubic-bezier(.4,0,.2,1);
}
.section.active{
 display:block;
 opacity:1;
 transform:translateY(0) scale(1);
 pointer-events:auto;
}

/* ===== BUTTONS ===== */
.btn{
 width:100%;min-height:52px;margin:8px 0;border:none;border-radius:16px;
 font-size:18px;font-weight:700;cursor:pointer;
 transition:all .3s ease;
}
.btn-main{
 background:linear-gradient(135deg,#facc15,#ffea00);
 color:#000;
}
.btn-back{
 background:linear-gradient(135deg,#0f172a,#334155);
 color:#fff;
 border:1px solid #334155;
}
.btn:hover{
 box-shadow:0 4px 15px rgba(0,0,0,0.4);
 transform:scale(1.03);
}

/* ===== SETTINGS ===== */
.setting-item{
 display:flex;justify-content:space-between;align-items:center;
 background:#0f172a;border:1px solid #334155;
 border-radius:14px;padding:14px;margin:10px 0;
 font-size:18px;
}
.toggle{
 width:52px;height:28px;border-radius:20px;
 background:#334155;position:relative;cursor:pointer;
}
.toggle::after{
 content:"";position:absolute;top:4px;right:4px;
 width:20px;height:20px;border-radius:50%;
 background:#fff;transition:.3s;
}
.toggle.on{background:var(--accent)}
.toggle.on::after{right:28px}

/* ===== ANSWER BOXES ===== */
.answer-boxes{
 display:flex;justify-content:center;gap:8px;margin:12px 0;direction:ltr;
}
.answer-box{
 width:44px;height:44px;border-radius:10px;
 background:#fff;color:#000;
 display:flex;align-items:center;justify-content:center;font-size:22px;
 transition:all .3s ease;
}
.answer-box.ok{
 background:linear-gradient(135deg,#22c55e,#4ade80);
 color:#fff;
}
.answer-box.bad{
 background:linear-gradient(135deg,#ef4444,#f87171);
 color:#fff;
}

/* ===== KEYBOARD ===== */
.keyboard{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.triangle{grid-template-columns:repeat(3,1fr)}
.key{
 background:#1e293b;
 padding:14px;
 border-radius:14px;
 text-align:center;
 font-size:22px;
 font-weight:bold;
 cursor:pointer;
 touch-action:none; 
 transition:transform .08s ease, box-shadow .3s ease, background .3s ease;
}
.key.locked{
 position:relative;
 opacity:.35;
 pointer-events:none;
}
.key.locked::after{
 content:"ğŸ”’";
 position:absolute;
 inset:0;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:26px;
}
.key.used{opacity:.25;pointer-events:none}
.key.shake{
 animation:shake .3s;
}
.key:active{
 transform:scale(0.92);
 box-shadow:0 4px 10px rgba(0,0,0,0.3);
}
.key:hover:not(.locked){
 background:linear-gradient(135deg,#334155,#1e293b);
 box-shadow:0 4px 12px rgba(0,0,0,0.4);
}
@keyframes shake{
 0%{transform:translateX(0)}
 25%{transform:translateX(-4px)}
 50%{transform:translateX(4px)}
 75%{transform:translateX(-4px)}
 100%{transform:translateX(0)}
}

/* ===== WHEEL ===== */
.wheel{
 width:260px;height:260px;margin:16px auto;
 border-radius:50%;
 border:3px solid var(--accent);
 position:relative;
 background: conic-gradient(from 0deg, #facc15, #ffea00, #22c55e, #4ade80, #facc15);
 animation: wheelRotate 10s linear infinite;
}
@keyframes wheelRotate {
  0%{transform:rotate(0deg);}
  100%{transform:rotate(360deg);}
}
.wheel .key{
 width:52px;height:52px;border-radius:50%;
 background:var(--accent);color:#000;
 position:absolute;display:flex;align-items:center;justify-content:center;
 transition:all .3s ease, transform .2s ease;
}
.wheel .key:hover{
 transform:scale(1.2);
 box-shadow:0 6px 15px rgba(0,0,0,0.4);
}

/* ===== DELETE BUTTON ===== */
.delete{
 background:#0f172a;border:1px solid #334155;
 border-radius:14px;padding:14px;font-size:20px;font-weight:bold;cursor:pointer;
 transition:all .3s ease;
}
.delete:hover{
 box-shadow:0 4px 12px rgba(0,0,0,0.3);
 transform:scale(1.05);
}

/* ===== OVERLAY & WIN ===== */
.overlay{
 position:fixed;inset:0;background:rgba(0,0,0,.8);
 display:none;justify-content:center;align-items:center;z-index:5;
}
.overlay.active{display:flex}
.win{
 background:#020617;padding:26px;border-radius:22px;
 box-shadow:0 0 60px var(--accent);text-align:center;
}

/* ===== CONFETTI ===== */
.confetti{
 position:fixed;top:-20px;font-size:26px;
 animation:fall linear forwards;pointer-events:none;z-index:10;
 color: #facc15;
}
.confetti:nth-child(odd){color:#22c55e;}
.confetti:nth-child(even){color:#ff4444;}
@keyframes fall{
 to{
  transform:translateY(120vh) rotate(720deg) rotateX(360deg);
  opacity:0;
 }
}
</style>
</head>

<body>

<div class="card">

<div id="menu" class="section active">
 <h1>âµ£Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ùˆ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©âµ£</h1>
 <button class="btn btn-main" onclick="openMap()">â–¶ï¸ â´±â´·â´° Ø¨Ø¯Ø¡</button>
 <button class="btn btn-back" onclick="show('settings')">âš™ï¸ settings</button>
</div>

<div id="settings" class="section">
 <h1>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>

 <div class="setting-item">
  <span>ğŸ”Š Ø§Ù„ØµÙˆØª</span>
  <div id="soundToggle" class="toggle"></div>
 </div>

 <div class="setting-item">
  <span>ğŸ“³ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²</span>
  <div id="vibeToggle" class="toggle"></div>
 </div>

 <button class="btn btn-back" onclick="show('menu')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<div id="map" class="section">
 <h1>â­ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</h1>
 <div id="mapGrid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px"></div>
 <button class="btn btn-back" onclick="show('menu')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

<div id="game" class="section">
 <h1 id="levelTitle"></h1>
 <img id="questionImg">
<div id="questionText" style="display:none;margin:12px 0;font-size:18px;line-height:1.6"></div>
 <div class="answer-boxes" id="boxes"></div>
<!-- START HINT BUTTON -->
<button class="btn btn-back" id="hintBtn">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
<div id="hintCount">3</div>
<!-- END HINT BUTTON -->
 <div id="wheel" class="wheel"></div>
 <div id="keyboard" class="keyboard"></div>
 <button class="btn btn-back" onclick="show('map')">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
</div>

</div>

<div id="overlay" class="overlay">
 <div class="win"><h2>ğŸ”¥ Ø£Ø­Ø³Ù†Øª ğŸ”¥</h2></div>
</div>
<div id="finalOverlay" class="overlay">
 <div class="win">
  <h2>ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! ğŸ†</h2>
  <p>Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¨Ù†Ø¬Ø§Ø­</p>
  <button class="btn btn-main" onclick="finalOverlay.classList.remove('active'); show('menu');">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
 </div>
</div>
<div id="stageOverlay" class="overlay">
 <div class="win">
  <h2>âœ¨ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø© âœ¨</h2>
  <div id="starsView" style="font-size:32px;margin:12px 0"></div>
  <button class="btn btn-main" id="nextStageBtn">â–¶ï¸ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
  <button class="btn btn-back" onclick="show('map'); stageOverlay.classList.remove('active')">ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
 </div>
</div>
<script>
let stars = JSON.parse(localStorage.getItem("amazighStars") || "[]");
const boxes = document.getElementById("boxes");
const keyboard = document.getElementById("keyboard");
const wheel = document.getElementById("wheel");
const mapGrid = document.getElementById("mapGrid");
const levelTitle = document.getElementById("levelTitle");
const questionImg = document.getElementById("questionImg");
const questionText = document.getElementById("questionText");
const overlay = document.getElementById("overlay");
const stageOverlay = document.getElementById("stageOverlay");
const starsView = document.getElementById("starsView");
const nextStageBtn = document.getElementById("nextStageBtn");
/* ===== SETTINGS ===== */
let soundOn = localStorage.getItem("soundOn") !== "0";
let vibeOn  = localStorage.getItem("vibeOn")  !== "0";

/* ğŸ”Š ØµÙˆØª Ø§Ù„ØªØµÙÙŠÙ‚ */
const applauseSound = new Audio("applause.mp3");

const soundToggle = document.getElementById("soundToggle");
const vibeToggle  = document.getElementById("vibeToggle");

function syncToggles(){
 soundToggle.classList.toggle("on",soundOn);
 vibeToggle.classList.toggle("on",vibeOn);
}
soundToggle.onclick=()=>{
 soundOn=!soundOn;
 localStorage.setItem("soundOn",soundOn?1:0);
 syncToggles();
};
vibeToggle.onclick=()=>{
 vibeOn=!vibeOn;
 localStorage.setItem("vibeOn",vibeOn?1:0);
 syncToggles();
};
syncToggles();

/* ===== SOUND (synthetic clap) ===== */
let ctx;
function clap(){
 if(!soundOn) return;
 if(!ctx) ctx=new (window.AudioContext||window.webkitAudioContext)();
 for(let i=0;i<6;i++){
  const o=ctx.createOscillator(),g=ctx.createGain();
  o.type="square"; o.frequency.value=200+Math.random()*400;
  g.gain.setValueAtTime(.5,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(.01,ctx.currentTime+.15);
  o.connect(g).connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+.15);
 }
 if(vibeOn && navigator.vibrate) navigator.vibrate([80,40,80]);
}

/* ===== DATA (5 Ù…Ø±Ø§Ø­Ù„ Ã— 3 Ø£Ø³Ø¦Ù„Ø©) ===== */
const stages=[/* Ù†ÙØ³ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù„Ø§ Ø£ÙŠ Ø­Ø°Ù */ 
 {qs:[
  {a:"âµœâ´°â´¼âµ“âµ¢âµœ",shape:"circle",img:"sun.jpg"},
  {a:"â´°âµ¢âµ“âµ”",shape:"triangle",img:"moon.jpg"},
  {a:"âµ‰âµœâµ”â´°âµ",shape:"grid",img:"stars.jpg"}
 ]},
 {qs:[
  {a:"â´°â´·âµ”â´°âµ”",shape:"circle",img:"mountain.jpg"},
  {a:"â´°âµ™âµ‰â´¼",shape:"triangle",img:"river.jpg"},
  {a:"âµœâ´°âµâ´°âµ£âµ‰âµ”âµœ",shape:"grid",img:"flower.jpg"}
 ]},
 {qs:[
  {a:"â´°âµ£âµ£âµ“",shape:"circle",img:"flowers.jpg"},
  {a:"â´°âµâ´°âµ",shape:"triangle",img:"river.jpg"},
  {a:"â´°â´¼â´°âµ™",shape:"grid",img:"insect.jpg"}
 ]},
 {qs:[
  {a:"â´°â´½â´°âµ",shape:"circle",img:"sun.jpg"},
  {a:"â´°âµâµ£â´°âµ”",shape:"triangle",img:"moon.jpg"},
  {a:"â´°â´¼âµ“âµ™",shape:"grid",img:"flower.jpg"}
 ]},
 {qs:[
  {a:"â´°âµ£âµ£âµ“",shape:"circle",img:"stars.jpg"},
  {a:"â´°âµâ´°âµ",shape:"triangle",img:"river.jpg"},
  {a:"âµœâ´°â´¼âµ“âµ¢âµœ",shape:"grid",img:"sun.jpg"}
 ]}
,
{qs:[
  {
    a:"â´°âµ£âµ”â´°âµ¡",
    shape:"grid",
    img:"riddle1.jpg"
  },
  {
    a:"âµœâ´°âµâµâµ“âµ”âµœ",
    shape:"triangle",
    img:"riddle2.jpg"
  },
  {
    a:"â´°âµâ´°âµ£âµ‰âµ–",
    shape:"circle",
    img:"riddle3.jpg"
  }
]}
,
{qs:[
  {
    a:"âµœâ´°âµâ´°âµ£âµ‰âµ–âµœ",
    shape:"grid",
    img:null,
    text:"Ù„ØºØ© Ø´Ù…Ø§Ù„ Ø¥ÙØ±ÙŠÙ‚ÙŠØ§ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©"
  },
  {
    a:"â´°âµâ´°âµ£âµ‰âµ–",
    shape:"triangle",
    img:null,
    text:"Ø§Ø³Ù… Ø§Ù„Ø´Ø¹Ø¨ Ø§Ù„Ø­Ø±"
  },
  {
    a:"âµ£",
    shape:"circle",
    img:null,
    text:"Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠ"
  }
]}
,
{qs:[
  {
    a:"âµœâ´°âµâµ“âµ”âµœ",
    shape:"grid",
    img:null,
    text:"ØªØ¹Ù†ÙŠ Ø§Ù„Ø£Ø±Ø¶ Ø£Ùˆ Ø§Ù„ÙˆØ·Ù†"
  },
  {
    a:"â´°â´½â´°âµ",
    shape:"triangle",
    img:null,
    text:"ÙƒÙ„ Ù…Ø§ Ù‡Ùˆ ØªØ±Ø§Ø¨ ÙˆØ·Ø¨ÙŠØ¹Ø©"
  },
  {
    a:"â´°âµ£âµ£â´°âµ”",
    shape:"circle",
    img:null,
    text:"Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©"
  }
]}
,
{qs:[
  {
    a:"âµâ´°âµ™âµ‰âµâµ‰âµ™â´°",
    shape:"grid",
    text:"Ù…Ù„Ùƒ Ø£Ù…Ø§Ø²ÙŠØºÙŠ ÙˆØ­Ù‘Ø¯ Ù†ÙˆÙ…ÙŠØ¯ÙŠØ§ ÙˆÙ‚Ø§ÙˆÙ… Ø§Ù„Ø±ÙˆÙ…Ø§Ù†",
  },
  {
    a:"âµ¢âµ“â´³âµ“âµ”âµœâ´°",
    shape:"triangle",
    img:"jugurtha.jpg"
  },
  {
    a:"âµœâ´°âµâ´°âµ£âµ‰âµ–âµœ",
    shape:"circle",
    text:"Ø§Ø³Ù… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©"
  }
]}
,
{qs:[
  {
    a:"â´½â´°âµ€âµ‰âµâ´°",
    shape:"circle",
    img:"kahina.jpg"
  },
  {
    a:"âµâµ“âµâµ‰â´·âµ¢â´°",
    shape:"grid",
    text:"Ù…Ù…Ù„ÙƒØ© Ø£Ù…Ø§Ø²ÙŠØºÙŠØ© Ù‚Ø¯ÙŠÙ…Ø© ÙÙŠ Ø´Ù…Ø§Ù„ Ø¥ÙØ±ÙŠÙ‚ÙŠØ§"
  },
  {
    a:"âµ£",
    shape:"triangle",
    text:"Ø±Ù…Ø² Ø§Ù„Ø­Ø±ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØº"
  }
]}
];

let unlocked=+localStorage.getItem("amazighUnlocked")||0;
let stage=0,q=0,input=[],drag=false;
const symbols=["ğŸ¤—","ğŸ¤©","ğŸ‘","ğŸ‘","ğŸ‘","ayuuz","â´°âµ¢âµ¢âµ“âµ£","ğŸŒ¸","ğŸŒº","ğŸŒ¹","â¤ï¸","ğŸ’–","ğŸ’","âµ£","âµ‰","âµœ","â´°","ğŸŒ¸","ğŸŒº","ğŸŒ¹","ğŸƒ","ğŸƒ","ğŸŒ·","ğŸŒ¼","ğŸŒ»","âš˜","ğŸˆ","ğŸˆ","ğŸ’µ","ğŸ’¶","ğŸ’¸","âœ”","âœ…"];

function show(id){

 document.querySelectorAll(".section").forEach(s=>{
  s.classList.remove("active");
  s.style.display = "none";
 });

 document.body.offsetHeight; // â† Ù…Ù‡Ù…

 const el = document.getElementById(id);
 el.style.display = "block";

 requestAnimationFrame(()=>{
  el.classList.add("active");
 });

}

function openMap(){
 mapGrid.innerHTML="";
 stages.forEach((_,i)=>{
  const d=document.createElement("div");
  d.className = "key" + (i > unlocked ? " locked" : "");
  const s = stars[i] || 0;
  d.innerHTML = `
   <div>Ù…Ø±Ø­Ù„Ø© ${i+1}</div>
   <div style="font-size:16px">
    ${"â­".repeat(s)}${"â˜†".repeat(3-s)}
   </div>
  `;
  if(i<=unlocked)d.onclick=()=>startStage(i);
  mapGrid.appendChild(d);
 });
 show("map");
}
let hintsLeft = 3;
let hintsUsed = 0;

function startStage(i){
 stage = i;
 q = 0;
 hintsLeft = 3;
 hintsUsed = 0;
 startQuestion();
}

function startQuestion(){
 input = [];
updateHintCount();
 const L = stages[stage].qs[q];
 levelTitle.textContent = `Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${stage+1} â€” Ø³Ø¤Ø§Ù„ ${q+1}/3`;

 if(L.img){
  questionImg.style.display = "block";
  questionImg.src = L.img;
  questionText.style.display = "none";
 }else{
  questionImg.style.display = "none";
  questionText.style.display = "block";
  questionText.textContent = L.text || "";
 }

 renderBoxes(L);
 renderBoard(L);
 show("game");
}

function renderBoxes(L){
 boxes.innerHTML="";
 for(let i=0;i<L.a.length;i++) boxes.innerHTML+=`<div class="answer-box"></div>`;
}

function renderBoard(L){
 keyboard.innerHTML=""; wheel.innerHTML="";
 keyboard.style.display="none"; wheel.style.display="none";
 const letters=[...L.a].sort(()=>Math.random()-.5);

 if(L.shape==="circle"){
  wheel.style.display="block";
  const r=110,c=130;
  letters.forEach((ch,j)=>{
   const a=2*Math.PI*j/letters.length;
   const k=makeKey(ch);
   k.style.left=c+r*Math.cos(a)-26+"px";
   k.style.top =c+r*Math.sin(a)-26+"px";
   wheel.appendChild(k);
  });

 }else{
  keyboard.style.display="grid";
  keyboard.className = L.shape === "triangle" ? "triangle" : "keyboard";

  letters.forEach(ch=>{
    const k = makeKey(ch);
    k.addEventListener("click", ()=>{
      pick(k, L);   // Ù†Ù‚Ø± ÙÙ‚Ø·
    });
    keyboard.appendChild(k);
  });

  const del = document.createElement("div");
  del.className = "delete";
  del.textContent = "âŒ«";
  del.onclick = removeLast;
  keyboard.appendChild(del);
 }
}
function makeKey(ch){
 const k = document.createElement("div");
 k.className = "key";
 k.textContent = ch;
 k.dataset.ch = ch;
 return k;
}

function pick(el,L){
 if(el.classList.contains("used")||input.length>=L.a.length)return;
 el.classList.add("used");
if(vibeOn && navigator.vibrate) navigator.vibrate(20);
 input.push(el); refresh();
 if(input.length===L.a.length && L.shape!=="circle") check(L);
}

function removeLast(){
 if(!input.length)return;
 const last=input.pop(); if(last) last.classList.remove("used"); refresh();
}
document.getElementById("hintBtn").onclick = () => {
 const L = stages[stage].qs[q];

 if (hintsLeft <= 0) return;              // Ù„Ø§ ØªÙ„Ù…ÙŠØ­Ø§Øª
 if (input.length >= L.a.length) return; // Ø§Ù„Ø¬ÙˆØ§Ø¨ Ù…ÙƒØªÙ…Ù„

 const ch = L.a[input.length];
 const keys = document.querySelectorAll(".key");

 for (let k of keys) {
  if (k.dataset.ch === ch && !k.classList.contains("used")) {
   pick(k, L);
   hintsLeft--; // 3 â†’ 2 â†’ 1 â†’ 0
hintsUsed++;
updateHintCount();
   break;
  }
 }
};

wheel.addEventListener("pointerdown",e=>{
 const L=stages[stage].qs[q];
 if(L.shape!=="circle")return; drag=true; dragPick(e,L);
});
wheel.addEventListener("pointermove",e=>{ if(drag) dragPick(e,stages[stage].qs[q]); });
document.addEventListener("pointerup",()=>{ if(drag){drag=false;
updateHintCount();
 check(stages[stage].qs[q]);} });

function dragPick(e,L){
 const el=document.elementFromPoint(e.clientX,e.clientY);
 if(el&&el.classList.contains("key")) pick(el,L);
}
function updateHintCount(){
 document.getElementById("hintCount").textContent = hintsLeft;
}

function refresh(){
 document.querySelectorAll(".answer-box").forEach((b,i)=>{
  b.textContent=input[i]?.dataset.ch||""; b.className="answer-box";
 });
}

function celebrate(){
 if(soundOn){
 applauseSound.currentTime = 0;
 applauseSound.play();
}
 for(let i=0;i<40;i++){
  const c=document.createElement("div");
  c.className="confetti";
  c.textContent=symbols[Math.floor(Math.random()*symbols.length)];
  c.style.left=Math.random()*100+"vw";
  c.style.animationDuration=2+Math.random()*2+"s";
  document.body.appendChild(c);
  setTimeout(()=>c.remove(),4000);
 }
}

function check(L){
 if(input.length!==L.a.length)return;
 const ok=input.map(k=>k.dataset.ch).join("")===L.a;
 document.querySelectorAll(".answer-box").forEach(b=>b.classList.add(ok?"ok":"bad"));

 if(ok){
  celebrate(); overlay.classList.add("active");
  setTimeout(()=>{
   overlay.classList.remove("active");
   q++;
   if(q<3) startQuestion();
  else{
 const s = getStars();
 stars[stage] = Math.max(stars[stage] || 0, s);
 localStorage.setItem("amazighStars", JSON.stringify(stars));

 starsView.textContent = "â­".repeat(s) + "â˜†".repeat(3 - s);
 stageOverlay.classList.add("active");

 if(stage === unlocked){
  unlocked++;
  localStorage.setItem("amazighUnlocked", unlocked);
 }

 nextStageBtn.onclick = ()=>{
  stageOverlay.classList.remove("active");
  if(stage === stages.length - 1){
   document.getElementById("finalOverlay").classList.add("active");
  }else{
   startStage(stage + 1);
  }
 };
}
  },1200);
 }else setTimeout(startQuestion,700);
 }
function getStars(){
 if(hintsUsed === 0) return 3;
 if(hintsUsed === 1) return 2;
 return 1;
}
</script>
</body>
</html>
